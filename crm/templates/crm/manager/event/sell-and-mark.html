{% extends 'crm/base.html' %}

{% load bootstrap4 %}

{% block content %}
  <div class="w-100">
    <legend class="border-bottom mb-2">Продать абонемент и отметить на занятии
      {{ event.date }} - {{ event.event_class.name }} -
      {{ event.event_class.location }} - {{ event.event_class.coach }}
    </legend>
    <div class="row">
      <form
        action="{% url 'crm:manager:event-class:event:sell-and-mark' event.event_class.id event.date.year event.date.month event.date.day %}"
        method="post"
      >
        <h5>Клиент: {{ client.name }}</h5>

        {% csrf_token %}
        {% bootstrap_form form %}

        <button type="submit" class="btn btn-primary">Продать и отметить
        </button>
        <a
          type="button" class="btn btn-outline-info" href="{{ form_back }}"
        >Назад</a>
      </form>
    </div>
  </div>
{% endblock %}

{% block extrahead %}
  {{ form.media.css }}
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-theme/0.1.0-beta.10/select2-bootstrap.min.css"
  >
{% endblock %}

{% block extra %}
  {{ form.media.js }}
  <script type="text/javascript">
    $(function () {
      $('#{{ form.subscription.id_for_label }}')
        .select2({theme: 'bootstrap'})
        .on('select2:select', function (e) {
          let $visits = $('#{{ form.visits_left.id_for_label }}');
          let $price = $('#{{ form.price.id_for_label }}');
          if (e.params.data.id === '') {
            $visits.val('');
            $price.val('');
          } else {
            let $elem = $(e.params.data.element);
            $visits.val($elem.data('visits'));
            $price.val($elem.data('price'));
          }
        });
    });
  </script>
{% endblock %}
