{% extends "crm/base.html" %}

{% block content %}

  {{ event.date }} - {{ event.event_class.name }} -
  {{ event.event_class.location }} - {{ event.event_class.coach }}
  {% if event.is_closed %}
    Тренировка закрыта!
  {% endif %}
  <div class="border-top mt-2"></div>
  <div class="row">
    <div class="col">
      {% if not event.is_closed %}
        <div class="mb-2 mt-2">
          <a class="btn btn-sm btn-outline-info"
             href="{% url 'crm:manager:event-class:event:mark-attendance' event.event_class.id event.date.year event.date.month event.date.day %}">Отметить
            посещение</a>
          <a class="btn btn-sm btn-outline-info"
             href="{% url 'crm:manager:event-class:event:scanner' event.event_class.id event.date.year event.date.month event.date.day %}">Сканнер</a>
        </div>
      {% endif %}
      <div class="border-top">
        <span class="font-weight-bold ">Отмеченные ученики: </span>
        <div class="border-top">
          {% for attendance in attendance_list %}
            <div class="row border-top ml-0 mr-0">
              <div class="col pl-0">
                {{ attendance.client.name }}
              </div>
              <div class="col">
                {{ attendance.subscription.subscription.name }}
              </div>
              <div class="col"></div>
              <div class="col"></div>
              <div class="col">
                {% if not event.is_non_editable %}
                  <a
                    class="btn btn-sm btn-outline-danger"
                    href="{% url 'crm:manager:attendance:delete' attendance.id %}"
                  >Удалить</a>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
      <div class="border-top mt-2"></div>
      {% if not event.is_non_editable %}
        <div class="border-top">
          <span class="font-weight-bold ">Не отмеченные ученики: </span>
          <div class="border-top">
            {% for key, value in clients_subscriptions.items %}
              <div class="row border-top ml-0 mr-0">
                <div class="col pl-0">
                  {{ key.name }}
                </div>
                <div class="col"></div>
                <div class="col"></div>
                <div class="col">
                  {% for subscription in value %}
                    <a class="btn btn-sm btn-outline-info" href="{% url 'crm:manager:event-class:event:mark-client-attendance' event.event_class.id event.date.year event.date.month event.date.day subscription.id %}">
                      {{ subscription.subscription.name }}
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
  {% if event.is_active %}
    <div class="row">
      <div class="alert alert-light" role="alert">
        {% if not event.is_closed %}
          {% if not event.is_canceled %}
            <a
              href="{% url 'crm:manager:event-class:event:cancel-without-extending' event.event_class.id event.date.year event.date.month event.date.day %}"
              class="btn btn-outline-danger mr-2"
              role="button"
            >
              Отменить тренировку
            </a>
            <a
              href="{% url 'crm:manager:event-class:event:cancel-with-extending' event.event_class.id event.date.year event.date.month event.date.day %}"
              class="btn btn-outline-danger"
              role="button"
            >
              Отменить и продлить абонементы
            </a>
          {% else %}
            <a
              href="{% url 'crm:manager:event-class:event:activate-without-revoke' event.event_class.id event.date.year event.date.month event.date.day %}"
              class="btn btn-outline-success mr-2"
              role="button"
            >
              Вернуть тренировку
            </a>
            {% if event.canceled_with_extending %}
              <a
                href="{% url 'crm:manager:event-class:event:activate-with-revoke' event.event_class.id event.date.year event.date.month event.date.day %}"
                class="btn btn-outline-success"
                role="button"
              >
                Вернуть тренировку и отменить проделния
              </a>
            {% endif %}
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endif %}
  {% if event.is_event_close %}
    {% if not event.is_closed %}
      <div class="row">
        <div class="alert alert-light" role="alert">
          <a
            href="{% url 'crm:manager:event-class:event:close-event' event.event_class.id event.date.year event.date.month event.date.day%}"
            class="btn btn-outline-danger mr-2"
            role="button"
          >
            Закрыть тренировку
          </a>
        </div>
      </div>
    {% endif %}
  {% endif %}

{% endblock content %}
