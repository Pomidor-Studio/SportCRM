{% load html_helper %}

<div class="btn-group">
  <a class="btn btn-icon btn-more" data-toggle="dropdown" aria-haspopup="true"
     aria-expanded="false"><span></span></a>
  <div class="dropdown-menu dropdown-menu-right">
    {% if not client.deleted %}
      {% if has_active_event_class %}
        {% ifhasperm 'client_subscription.sale' user %}
          <a class="dropdown-item"
             href="{% url 'crm:manager:client:new-subscription' client.id %}"
             data-client-id="{{ client.id }}">Продать абонемент</a>
        {% endifhasperm %}
      {% endif %}
      {% ifhasperm 'client-balance.add' user %}
        <a class="dropdown-item"
           href="{% url 'crm:manager:client:balance:new' client.id %}"
           data-client-id="{{ client.id }}">Пополнить баланс</a>
      {% endifhasperm %}
      {% ifhasperm 'client' user %}
        <a class="dropdown-item"
           href="{% url 'crm:manager:client:detail' client.id %}"
           data-client-id="{{ client.id }}">Перейти к карточке ученика</a>
      {% endifhasperm %}
      {% if client.vk_user_id or client.phone_number %}
        <div class="greyline"></div>
        {% if client.vk_user_id %}
          {% if vk_group_id %}
            <a class="dropdown-item"
               href="https://vk.com/gim{{ vk_group_id }}?sel={{ client.vk_user_id }}"
               data-client-id="92">
              Написать в Вконтакте
            </a>
          {% else %}
            <a class="dropdown-item"
               href="https://vk.com/?sel={{ client.vk_user_id }}"
               data-client-id="92">
              Написать в Вконтакте
            </a>
          {% endif %}
        {% endif %}
        {% if client.phone_number %}
          <a class="dropdown-item" href="tel:{{ client.phone_number }}"
             data-client-id="92">Позвонить</a>
        {% endif %}
      {% endif %}
      <div class="greyline"></div>
      {% ifhasperm 'client.delete' user %}
        <a class="dropdown-item"
           href="{% url 'crm:manager:client:delete' client.id %}"
           data-client-id="{{ client.id }}">Переместить в архив</a>
      {% endifhasperm %}
    {% else %}
      {% ifhasperm 'client.undelete' user %}
        <a class="dropdown-item"
           href="{% url 'crm:manager:client:undelete' client.id %}"
           data-client-id="{{ client.id }}">Вернуть из архива</a>
      {% endifhasperm %}
    {% endif %}
  </div>
</div>
