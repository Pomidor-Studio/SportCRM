{% extends "crm/base.html" %}

{% load bootstrap4 %}

{% block extrahead %}
  {{ form.media }}
{% endblock %}

{% block content %}

  <script language="javascript">
    $(function () {
      $("#id_subscription").change(function () {
        $("#id_price").val($(this).find("option:selected").attr("price"));
        $("#id_visits_left").val($(this).find("option:selected").attr("visit_limit"));
      });
    });
  </script>

  <div class="container-fluid mt-4 ml-2">
    <legend class="border-bottom mb-2">Абонемент</legend>
    <div class="w-100">
      <div class="row">
        <div class="col">
          <form method="POST">
            {% csrf_token %}
            <fieldset class="form-group">
              {% bootstrap_form form %}
            </fieldset>

            <div class="form-group">
              <button class="btn btn-outline-info" type="submit">Добавить
              </button>
              <a name="cancel"
                 href="
                   {% if object.client %}{% url 'crm:manager:client:detail' object.client.id %}{% else %}{% url 'crm:manager:client:detail' view.kwargs.client_id %}{% endif %}"
                 class="btn btn-outline-info">
                Назад
              </a>
            </div>
          </form>
        </div>
        <div class="col">
          {% if history %}
            <div>История продлений:</div>
            <div>
              <table class="table table-sm table-bordered">
                <thead>
                <tr>
                  <th scope="col">Дата продления</th>
                  <th scope="col">Причина продления</th>
                  <th scope="col">Кол-во занятий</th>
                </tr>
                </thead>
                <tbody>
                {% for hist_obj in history %}
                  <tr>
                    <td>{{ hist_obj.date_extended }}</td>
                    <td>{{ hist_obj.reason }}</td>
                    <td>{{ hist_obj.added_visits }}</td>
                  </tr>
                {% endfor %}
                </tbody>
              </table>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
