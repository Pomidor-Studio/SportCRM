{% extends "crm/base.html" %}
{% block nav %}
{% endblock nav %}
{% block content %}
<script type="text/javascript"></script>
<script>window.page_name = "Ученики";</script>

<script language="javascript">
    $(function() {
    $("#clear_search").click(function() {
        $("#search_input").val("");
    });
});


</script>


<div class="ml-4 mt-4 mr-4 container-fluid">
    <legend class="border-bottom mb-2">Ученики</legend>
    <div style="background-color: #FFFFFF;" class="sticky-top">
        <form class="form-inline mb-2" action="{% url 'crm:clients' %}" method="GET">
            <a name="add-new" href="{% url 'crm:client-new' %}" class="btn btn-sm btn-info">Добавить ученика</a>
            <div class="input-group  ml-2 w-25">
                <input id="search_input" name="client" placeholder="Искать по ФИО" value="{{ request.GET.client }}"
                       type="search" class="form-control form-control-sm">
                <div class="input-group-append">
                    <input id="clear_search" type="submit" value="X" class="btn btn-sm btn-outline-danger"
                           type="button">
                </div>
            </div>

            <input type="submit"
                   value="Поиск" class=" ml-2 btn btn-sm btn-success"/>
        </form>
    </div>


    <table class="table table-sm table-bordered">
        <thead>
        <tr>
            <th scope="col">Инфо</th>
            <th scope="col">Абонемент</th>
        </tr>
        </thead>
        <tbody>
        {% for c in clients %}
        <tr>
            <td>
                <a href="{% url 'crm:client-detail' c.id %}">
                    <div class="font-weight-bold">{{ c.name }}</div>
                    <div>{{ c.phone_number }}</div>
                    <div>{{ c.email_address }}</div>
                </a>
            </td>
            <td>
                {% if c.last_sub != null %}
                <div class="font-weight-bold">
                    {% if c.last_sub.is_expiring %}
                    <i title="Абонемент скоро заканчивается" class="fas fa-exclamation-circle"></i>
                    {% endif %}
                    {{ c.last_sub.subscription.name }}
                </div>
                <div>Действует до {{ c.last_sub.end_date|date:'d N Y' }}</div>
                <div>Осталось {{ c.last_sub.visits_left }} посещений</div>
                <a class="btn btn-sm btn-outline-info"
                   href="{% url 'crm:clientsubscription-extend' c.last_sub.id %}">Продлить</a>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    {% if is_paginated %}
    <ul class="pagination">
        {% if page_obj.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">&laquo;</a></li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
            {% ifequal num page_obj.number %}
                <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
            {% else %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
            {% endifequal %}
        {% endfor %}

        {% if page_obj.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
        {% else %}
            <li class="page-item disabled"><a class="page-link" href="#">&raquo;</a></li>
        {% endif %}
    </ul>
    {% endif %}

</div>

{% endblock content %}
